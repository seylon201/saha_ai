# 장림유수지 LSTM 수위 예측 모델 개발 - 진행 현황

**프로젝트명**: 2025년 인공지능(AI)기반 방재시설 및 유수지 관리체계 구축  
**작성일**: 2025년 10월 14일  
**현재 단계**: Phase 1 준비 단계

---

## 1. 프로젝트 개요

### 1.1 목표
- LSTM 기반 시계열 수위 예측 모델 개발
- 장림 유수지의 수위를 실시간으로 예측하여 방재 시설 자동 제어
- 예측 결과를 기반으로 출입문/경광등 제어 조건 생성

### 1.2 성능 목표
- **예측 정확도**: RMSE < 5cm
- **응답 시간**: < 1초 (실시간 예측)
- **정확도**: 90% 이상

---

## 2. 데이터 현황

### 2.1 수집된 데이터 파일
- **파일명**: `20251001_장림유수지_데이터정리_Ver2.xlsx`
- **구조**: 2개 시트 (수위, 펌프_벨브)

### 2.2 수위 시트 (23행)
**카테고리별 센서**:

#### 외수위
- 외수위값 (SYSTEM.LT_104): -2m ~ 3.1m

#### 유수지 수위 ⭐ 예측 타겟
- 유수지 A (SYSTEM.LT_102): -1.4m ~ 1.1m
- 유수지 B (SYSTEM.LT_103): -1.4m ~ 1.1m

#### 펌프실 수위
- 펌프실 수위 EL (SYSTEM.LT_106_CAL): -3.8m ~ 1.2m
- 펌프실 수위 GL (SYSTEM.LT_107): 0m ~ 5m

#### 도수로 수위
- 도수로 수위계 (LS103.LT103): -2.6m ~ 0.4m

#### 오수 수위
- 오수 내수위 GL (SYSTEM.LT_101): 0m ~ 5m
- 오수 내수위 EL (SYSTEM.LT_101_EL): -5.5m ~ -0.7m

### 2.3 펌프/밸브 시트 (245행)
**주요 장비**:
- 게이트 펌프 1~6 (전류값, 운전/정지 상태)
- 측류 벨브 1~2
- 측류 펌프 1~2
- 우수 벨브 1~6
- 고압 펌프 1~3
- 엔진 펌프

**데이터 형식**:
- UINT16: 전류값 (0~300A)
- bool: 운전/정지, 고장 상태 (0/1)
- float: 수치 데이터

---

## 3. 개발 계획

### 3.1 개발해야 할 모델 (우선순위)

#### 1순위: LSTM 기반 시계열 수위 예측 모델 ⭐ 현재 진행
- 수위/유량/유속 데이터 기반 미래 상태 예측
- 센서 데이터 + 기상청 API 활용

#### 2순위: YOLOv5 목자판 검출 모델
- CCTV 영상에서 수위 측정용 목자판 자동 검출

#### 3순위: CNN+LSTM 통합 모델
- CCTV 영상 + 센서 데이터 융합 예측

---

## 4. Phase 1: 단순 LSTM 모델

### 4.1 데이터 제약사항
**문제**: 유량, 유속 데이터 없음

**해결책**: 대리 변수(Proxy Variables) 활용
- 펌프 운전 상태 + 전류값 → 유량 간접 표현
- 외수위 변화율 → 유입량 간접 표현
- 강수량 (기상청 API) → 유입량 직접 원인

### 4.2 Phase 1 모델 설계

#### 입력 데이터
```
[시계열 입력 - 과거 60분 데이터]
1. 수위 데이터 (7개)
   - 외수위, 유수지A/B, 펌프실EL/GL, 도수로, 오수수위

2. 파생 변수 (3개)
   - 외수위 변화율 (1분, 5분, 10분)
   - 유수지A 변화율
   - 유수지B 변화율

3. 펌프 운영 데이터 (12개)
   - 게이트 펌프 1~6 전류값
   - 게이트 펌프 1~6 운전 상태

4. 기상 데이터 (4개)
   - 강수량 (1시간 누적)
   - 기온, 습도, 풍속

5. 시간 특성 (3개)
   - 시각 (sin/cos 인코딩)
   - 요일 (원-핫 인코딩)

총 입력 변수: 약 20~25개
```

#### 모델 구조
```
입력층 (sequence_length=60, features=20~25)
    ↓
LSTM(128 units)
    ↓
Dropout(0.2)
    ↓
LSTM(64 units)
    ↓
Dropout(0.2)
    ↓
Dense(32, activation='relu')
    ↓
출력층 (6개)
- 유수지 A 수위 (10분, 30분, 60분 후)
- 유수지 B 수위 (10분, 30분, 60분 후)
```

#### 하이퍼파라미터
- **시퀀스 길이**: 60분 (과거 1시간)
- **배치 크기**: 32
- **학습률**: 0.001 (Adam)
- **손실 함수**: MSE (Mean Squared Error)
- **조기 종료**: 검증 손실 개선 없을 시 10 에포크

### 4.3 데이터셋 분할
- **훈련 데이터**: 70%
- **검증 데이터**: 20%
- **테스트 데이터**: 10%

### 4.4 개발 단계
1. **Week 1**: 데이터 전처리 및 EDA
2. **Week 2**: 단순 LSTM 모델 개발 및 학습
3. **Week 3**: 성능 평가 및 개선

---

## 5. 작업 환경 설정

### 5.1 선택한 환경
- **도구**: Claude Code (터미널 기반 AI 코딩 도구)
- **이유**: Python 실제 실행 환경, 데이터 처리 및 모델 학습 가능

### 5.2 프로젝트 폴더
```
폴더명: jangrim-lstm-prediction
경로: /mnt/c/jangrim-lstm-prediction
```

### 5.3 폴더 구조 (예정)
```
jangrim-lstm-prediction/
├── data/
│   ├── raw/                    # 원본 데이터
│   │   └── 20251001_장림유수지_데이터정리_Ver2.xlsx
│   ├── processed/              # 전처리된 데이터
│   └── train_test_split/       # 학습/검증/테스트 분할
├── notebooks/
│   └── 01_EDA.ipynb           # 탐색적 데이터 분석
├── src/
│   ├── data_preprocessing.py  # 데이터 전처리
│   ├── model.py               # LSTM 모델 정의
│   ├── train.py               # 모델 학습
│   └── evaluate.py            # 모델 평가
├── models/
│   └── checkpoints/           # 학습된 모델 저장
├── results/
│   ├── figures/               # 결과 그래프
│   └── logs/                  # 학습 로그
├── requirements.txt           # 필요 라이브러리
└── README.md
```

---

## 6. 기술 스택

### 6.1 개발 환경
- **언어**: Python 3.8+
- **프레임워크**: TensorFlow, Keras

### 6.2 주요 라이브러리
```python
# 데이터 처리
pandas
numpy
openpyxl  # Excel 파일 처리

# 딥러닝
tensorflow
keras

# 시각화
matplotlib
seaborn

# 기타
scikit-learn  # 전처리, 평가 지표
```

---

## 7. 다음 단계

### 7.1 즉시 수행할 작업
1. ✅ 프로젝트 폴더 생성 완료
2. ⏳ Claude Code 실행 및 작업 시작
3. ⏳ Excel 파일을 프로젝트 폴더로 복사
4. ⏳ 데이터 로딩 및 초기 탐색

### 7.2 Phase 1 상세 계획
**Step 1: 데이터 로딩 및 탐색 (1일)**
- Excel 파일 읽기
- 데이터 구조 파악
- 기초 통계 분석
- 결측치/이상치 확인

**Step 2: 데이터 전처리 (2일)**
- 결측치 처리 (선형 보간)
- 이상치 제거 (Z-score, IQR)
- 데이터 정규화 (Min-Max)
- 시계열 윈도우 생성

**Step 3: 모델 구축 (2일)**
- LSTM 모델 정의
- 학습 파이프라인 구축
- 콜백 함수 설정

**Step 4: 학습 및 평가 (2일)**
- 모델 학습
- 성능 평가 (RMSE, MAE, MAPE)
- 결과 시각화

---

## 8. 참고 문서

### 8.1 프로젝트 문서
- PRMS2025요구사항명세서v1.1.pdf
- PRMS2025기술환경 구성도v1.0.pdf
- 세부과제별추진방안.pdf

### 8.2 요구사항 ID
- **FR-008**: 시계열 데이터 예측 모델 구현
- **FR-009**: 통합 수위 예측 모델 구현
- **SFR-006**: 데이터 품질 관리

---

## 9. 이슈 및 해결 방안

### 9.1 데이터 부족 문제
**문제**: 유량, 유속 센서 데이터 부재

**해결책**:
- 대리 변수 활용 (펌프 전류, 외수위 변화율)
- 기상 데이터 적극 활용
- 시계열 자기상관 특성 활용

### 9.2 예상되는 도전 과제
1. 센서 데이터의 결측치 및 노이즈 처리
2. 시간 동기화 (센서 vs 기상 데이터)
3. 계절성/주기성 패턴 학습
4. 극단 상황 (폭우, 가뭄) 예측 능력

---

## 10. 성공 지표

### 10.1 정량적 지표
- RMSE < 5cm (수위 예측)
- MAE < 3cm
- 응답 시간 < 1초

### 10.2 정성적 지표
- 강수 이벤트 시 예측 정확도
- 안정적인 학습 곡선
- 일반화 성능 (테스트 데이터)

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 2025-10-14 | 1.0 | 초기 문서 작성 | - |

---

**Status**: 🚀 Claude Code 시작 준비 완료  
**Next Action**: Claude Code에서 데이터 로딩 및 전처리 시작
